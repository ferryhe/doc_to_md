version: '3.8'

services:
  doc-to-md:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: doc-to-md-converter
    environment:
      - DEFAULT_ENGINE=local
      # Add API keys via .env file or here
      # - MISTRAL_API_KEY=${MISTRAL_API_KEY}
      # - SILICONFLOW_API_KEY=${SILICONFLOW_API_KEY}
    volumes:
      # Mount local data directory for input/output
      - ./data:/app/data
      # Mount .env file if it exists
      - ./.env:/app/.env:ro
    command: >
      doc-to-md convert
      --input-path /app/data/input
      --output-path /app/data/output
      --engine local
    restart: unless-stopped

  # Optional: Service for processing with Mistral OCR
  doc-to-md-mistral:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: doc-to-md-mistral
    environment:
      - DEFAULT_ENGINE=mistral
      - MISTRAL_API_KEY=${MISTRAL_API_KEY}
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env:ro
    command: >
      doc-to-md convert
      --input-path /app/data/input
      --output-path /app/data/output_mistral
      --engine mistral
    restart: "no"
    profiles:
      - mistral

  # Optional: Service for processing with DeepSeek OCR
  doc-to-md-deepseek:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: doc-to-md-deepseek
    environment:
      - DEFAULT_ENGINE=deepseekocr
      - SILICONFLOW_API_KEY=${SILICONFLOW_API_KEY}
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env:ro
    command: >
      doc-to-md convert
      --input-path /app/data/input
      --output-path /app/data/output_deepseekocr
      --engine deepseekocr
    restart: "no"
    profiles:
      - deepseek

volumes:
  data:
    driver: local
